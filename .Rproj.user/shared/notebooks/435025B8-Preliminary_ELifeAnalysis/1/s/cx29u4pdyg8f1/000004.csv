"0","elife$status <- ifelse(elife$accepted, ""Accepted"", ifelse(elife$encouraged, ""Full Rejection"", ""Initial Rejection""))"
"0","generate_country_data <- function(elife, country_str, name_str = ""ca_name"", limit = 8) {"
"0","  elife$country = elife[[country_str]]"
"0","  elife$name = elife[[name_str]]"
"0","  "
"0","  all_submissions <- length(unique(elife$MSNO))"
"0","  all_accepted <- sum(elife$accepted == T, na.rm = T)"
"0","  all_encouraged <- sum(elife$encouraged == T, na.rm = T)"
"0","  all_bres <- length(unique(elife$bre_name))"
"0","  "
"0","  country_data <- elife %>%"
"0","    filter(!is.na(country)) %>%"
"0","    group_by(country) %>%"
"0","    summarize("
"0","      submissions = n(),"
"0","      num_people = length(unique(name)),"
"0","      encouraged = sum(encouraged == T, na.rm = T),"
"0","      accepted = sum(accepted == T, na.rm = T),"
"0","      encourage_rate = encouraged / submissions,"
"0","      acceptance_rate = accepted / submissions,"
"0","      prop_of_all = submissions / all_submissions,"
"0","      prop_of_encouraged = encouraged / all_encouraged,"
"0","      prop_of_accepted = accepted / all_accepted,"
"0","      prop_bre = length(unique(bre_name)) / all_bres"
"0","    ) %>%"
"0","    group_by(country) %>%"
"0","      mutate(totals = sum(submissions)) %>%"
"0","    ungroup() %>%"
"0","    top_n(limit, totals)"
"0","  return(country_data)"
"0","}"
"0","data <- generate_country_data(elife, ""ca_country"", limit = 8)"
"0","data$country <- reorder(data$country, data$submissions)"
"0","long_data <- data %>% "
"0","  gather(key,  value = measurement, prop_of_all, prop_of_encouraged, prop_of_accepted) %>%"
"0","  mutate(key = factor(key))"
"0","long_data$key <- factor(long_data$key, levels = levels(long_data$key)[c(2, 3, 1)])"
"0","labels <- c(prop_of_all = ""Proportion of All Submissions"", prop_of_encouraged = ""Proportion of All Encouraged"", prop_of_accepted = ""Proportion of All Accepted"")"
"0","p1 <- ggplot(long_data, aes(x = country, y = measurement)) +"
"0","  geom_bar(stat = ""identity"", color = ""black"", alpha = 0.8, fill = ""dodgerblue4"", position = position_dodge(5)) +"
"0","  geom_text(aes(y = measurement, label = paste0(round(measurement, 3) * 100, ""%"")), size = 2.5, hjust = -0.2, family = ""Times"") +"
"0","  scale_y_continuous(limits = c(0, 0.7)) +"
"0","  facet_wrap(~key, labeller = labeller(key = labels)) +"
"0","  theme_bw() +"
"0","  coord_flip() +"
"0","  labs(y = ""Proportion of All"") +"
"0","  theme("
"0","    strip.background = element_blank(),"
"0","    text = element_text(size = 10, family = ""Times""),"
"0","    plot.title = element_text(size = 12),"
"0","    strip.text = element_text(face = ""bold""),"
"0","    axis.title.y = element_blank()"
"0","  )"
"0","p1"
