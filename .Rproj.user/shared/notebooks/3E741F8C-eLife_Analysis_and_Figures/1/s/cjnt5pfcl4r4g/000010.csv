"0","# First, I'll go through and run all the tests to get signif. values. I toyed around with ways to do this more programatically, but I think that this"
"0","# manual method is perhaps the simplest"
"0","# First, test the encourage rate diffs"
"0","s <- subset(elife, initial_decision_made)"
"0","t <- table(""ca_gender"" = s$ca_gender, ""encouraged"" = s$encouraged)[1:2,]"
"0","ca_encouraged <- prop.test(t[, 2], rowSums(t))"
"0","# Difference in acceptance rates by gender of corresponding author"
"0","s <- subset(elife, initial_decision_made & (is.na(full_submission_date) | full_decision_made))"
"0","t <- table(""ca_gender"" = s$ca_gender, ""encouraged"" = s$accepted)[1:2,]"
"0","ca_accepted <- prop.test(t[, 2], rowSums(t))"
"0","# Difference in encourage-acceptance rates by gender of corresponding author"
"0","s <- subset(elife, initial_decision_made & full_decision_made)"
"0","t <- table(""ca_gender"" = s$ca_gender, ""accepted"" = s$accepted)[1:2,]"
"0","ca_ea <- prop.test(t[, 2], rowSums(t))"
"0","# Difference in encourage-acceptance rates by gender of first author"
"0","s <- subset(elife, initial_decision_made & full_decision_made)"
"0","t <- table(""fa_gender"" = s$fa_gender, ""accepted"" = s$accepted)[1:2,]"
"0","fa_ea <- prop.test(t[, 2], rowSums(t))"
"0","# Difference in encourage-acceptance rates by gender of last author"
"0","s <- subset(elife, initial_decision_made & full_decision_made)"
"0","t <- table(""la_gender"" = s$la_gender, ""accepted"" = s$accepted)[1:2,]"
"0","la_ea <- prop.test(t[, 2], rowSums(t))"
"0","# Now we use the results of these tests to construct a table"
"0","measurements <- c(rep(""submit_rate"", 3), rep(""encourage_rate"", 3), rep(""accept_rate"", 3), rep(""encourage_accept_rate"", 3))"
"0","author <- rep(c(""ca_gender"", ""fa_gender"", ""la_gender""), 4)"
"0","sig <- c(""N/A"", ""N/A"", ""N/A"", # submit rates, all NA since we don't really compare this"
"0","         sig2ast(ca_encouraged$p.value), ""N/A"", ""N/A"", # encourage rate"
"0","         sig2ast(ca_accepted$p.value), ""N/A"", ""N/A"", "
"0","         sig2ast(ca_ea$p.value), sig2ast(fa_ea$p.value), sig2ast(la_ea$p.value)"
"0","         )"
"0","sig_df <- data.frame(measure_key = factor(measurements), author_key = factor(author), sig = sig)"
"0","# Now lets save these test results for later"
"0","fig3.tests <- list(""Corresponding author enc. rate"" = ca_encouraged, "
"0","                   ""Corresponding author acc. rate"" = ca_accepted, "
"0","                   ""Corresponding author enc-acc rate"" = ca_ea, "
"0","                   ""First author enc-acc rate"" = fa_ea, "
"0","                   ""last author enc-acc rate"" = la_ea)"
"0","fig3 <- elife %>%"
"0","  filter(initial_decision_made) %>%"
"0","  gather(author_key, value = gender, ca_gender, la_gender, fa_gender) %>%"
"0","  group_by(author_key) %>%"
"0","  mutate("
"0","    total_papers = ifelse(author_key == ""ca_gender"", n(), sum(!is.na(full_submission_date)))"
"0","    )%>%"
"0","  group_by(author_key, gender) %>%"
"0","  summarize("
"0","        paper_count = n(),"
"0","        accept_count = sum(accepted == TRUE, na.rm = T),"
"0","        encourage_count = sum(encouraged == TRUE, na.rm = T),"
"0","        encourage_rate = ifelse(author_key[1] == ""ca_gender"", encourage_count / n(), NA),"
"0","        accept_rate = ifelse(author_key[1] == ""ca_gender"", accept_count / sum(is.na(full_submission_date) | full_decision_made, na.rm = T), NA),"
"0","        submit_rate = n() / total_papers[1],"
"0","        encourage_accept_rate = accept_count / sum(!is.na(full_submission_date) & full_decision_made, na.rm = T)"
"0","  ) %>%"
"0","  filter(gender %in% c('M', 'F')) %>%"
"0","  ungroup() %>%"
"0","  gather(measure_key, value = measurement, submit_rate, encourage_rate, accept_rate, encourage_accept_rate) %>%"
"0","  left_join(sig_df, by = c(""measure_key"", ""author_key"")) %>%"
"0","  mutate("
"0","    author_key = factor(author_key,"
"0","                        labels = c(""ca_author"" = ""Corresponding"", ""fa_author"" = ""First"", ""la_author"" = ""Last"")),"
"0","    measure_key = factor(measure_key, "
"0","                         labels = c(""submit_rate"" = ""Submissions"", ""encourage_rate"" = ""Enc. %"", ""accept_rate"" = ""Acc. %"", ""Enc-Acc %""),"
"0","                         levels = c(""submit_rate"", ""encourage_rate"", ""accept_rate"", ""encourage_accept_rate"")),"
"0","    gender = ifelse(gender == ""F"", ""Female"", ""Male"")"
"0","  ) %>%"
"0","  ggplot(aes(x = gender, y = measurement, color = factor(gender), shape = factor(gender), fill = factor(gender))) +"
"0","  geom_bar(stat = ""identity"", alpha = 0.8, color = ""black"") +"
"0","  geom_text(aes(x = gender, y = measurement + 0.10, label = paste0(round(measurement, 3) * 100, ""%"")), size = 2.5, color = ""black"", position = position_dodge(0.87)) +"
"0","  geom_text(aes(x = 1.5, y = 0.9, label = ifelse(measure_key == ""Submissions"", """", as.character(sig))), color = ""black"") +"
"0","  geom_segment(aes(x = 1, xend = 2, y = ifelse(sig != ""N/A"", 0.8, 1.1), yend = ifelse(sig != ""N/A"", 0.8, 1.1)), color = ""black"") +"
"0","  facet_grid(author_key ~ measure_key) +"
"0","  ylim(0, 1) +"
"0","  theme_dakota() +"
"0","  theme("
"0","    axis.title.x = element_blank()"
"0","  ) +"
"0","  labs("
"0","    x = ""Author Gender"","
"0","    y = ""%"","
"0","    caption = ""Chi-squared tests of equal proportion:\n**** = p <= 0.0001; *** = p <= 0.001; ** = p <= 0.01; ** = p <= 0.01; * = p <= 0.05; ns = p > 0.05"""
"0","  )"
"2","Column `measure_key` joining character vector and factor, coercing into character vector"
"2","Column `author_key` joining character vector and factor, coercing into character vector"
"0","fig3"
